<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Drone Weather Dashboard</title>

<style>
    /* ----- GLOBAL DARK BACKGROUND ----- */
    body {
        font-family: "Segoe UI", Arial, sans-serif;
        background: linear-gradient(135deg, #0d1117, #1a1f27);
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        color: #fff;
    }

    /* ----- GLASS PANEL ----- */
    #container {
        width: 92%;
        max-width: 520px;
        padding: 30px;
        background: rgba(255, 255, 255, 0.08);
        border-radius: 18px;
        box-shadow: 0 10px 35px rgba(0,0,0,0.4);
        backdrop-filter: blur(14px);
        -webkit-backdrop-filter: blur(14px);
        text-align: center;
        animation: fadeIn 0.6s ease-out;
        border: 1.2px solid rgba(255, 255, 255, 0.15);
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0px); }
    }

    .top-btn {
        display: inline-block;
        margin-bottom: 20px;
        padding: 10px 18px;
        background: linear-gradient(135deg, #00aaff, #007bff);
        border-radius: 8px;
        color: white;
        text-decoration: none;
        font-size: 15px;
        font-weight: bold;
        box-shadow: 0 4px 14px rgba(0,153,255,0.3);
    }

    h2 {
        margin-top: 0;
        font-size: 28px;
        font-weight: 600;
    }

    .weather-icon {
        width: 90px;
        height: 90px;
        margin: 12px auto;
        filter: drop-shadow(0 0 8px rgba(255,255,255,0.25));
    }

    .arrow {
        width: 60px;
        height: 60px;
        margin-top: 10px;
        transition: 0.4s ease;
        filter: drop-shadow(0 0 5px rgba(255,255,255,0.3));
    }

    .data {
        margin: 12px 0;
        font-size: 20px;
        font-weight: 500;
        color: #d4d7dd;
    }

    #risk {
        margin: 22px 0;
        padding: 16px;
        border-radius: 12px;
        font-size: 20px;
        font-weight: bold;
        color: white;
        transition: 0.3s ease;
    }

    input {
        padding: 12px;
        width: 42%;
        margin: 7px;
        border-radius: 10px;
        border: 1px solid rgba(255,255,255,0.2);
        background: rgba(255,255,255,0.09);
        color: #fff;
        font-size: 16px;
    }

    button {
        padding: 12px 26px;
        border: none;
        background: linear-gradient(135deg, #007bff, #00aaff);
        color: white;
        border-radius: 10px;
        cursor: pointer;
        font-size: 17px;
        margin-top: 12px;
        font-weight: bold;
    }
</style>
</head>

<body>

<div id="container">

    <!-- Return to survey without restarting -->
    <a class="top-btn" href="javascript:history.back()">
        ðŸ”™ Return to Survey
    </a>

    <h2>ðŸ“¡ Live Drone Weather</h2>

    <img id="icon" class="weather-icon" src="" alt="Weather Icon">

    <div class="data" id="temp">Temperature: --</div>
    <div class="data" id="wind">Wind Speed: --</div>
    <div class="data" id="direction">Wind Direction: --</div>

    <img id="arrow" class="arrow" src="https://img.icons8.com/ios-filled/100/ffffff/arrow.png" alt="Wind Arrow">

    <div class="data" id="humidity">Humidity: --</div>
    <div class="data" id="condition">Condition: --</div>

    <div id="risk">Flight Risk: --</div>

    <hr>

    <h3>ðŸ”¢ Manual Coordinates (If GPS blocked)</h3>
    <input id="lat" placeholder="Latitude">
    <input id="lon" placeholder="Longitude">
    <br>
    <button onclick="manualWeather()">Update Weather</button>
</div>

<script>
const API_KEY = "a450b5efb217120de10b1c84bb11a906";

/* Convert degrees to compass direction */
function degToCompass(deg) {
    const dirs = ["N", "NE", "E", "SE", "S", "SW", "W", "NW"];
    return dirs[Math.round(deg / 45) % 8];
}

function updateRisk(wind) {
    const box = document.getElementById("risk");

    if (wind < 5) {
        box.style.background = "rgba(40, 167, 69, 0.85)";
        box.textContent = "Flight Risk: LOW (Safe)";
    } else if (wind < 10) {
        box.style.background = "rgba(255, 165, 0, 0.85)";
        box.textContent = "Flight Risk: MEDIUM (Caution)";
    } else {
        box.style.background = "rgba(220, 53, 69, 0.85)";
        box.textContent = "Flight Risk: HIGH (Unsafe)";
    }
}

async function getWeather(lat, lon) {
    const url =
      `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${API_KEY}&units=metric`;

    const res = await fetch(url);
    const data = await res.json();

    document.getElementById("temp").textContent = `Temperature: ${data.main.temp} Â°C`;
    document.getElementById("wind").textContent = `Wind Speed: ${data.wind.speed} m/s`;

    let deg = data.wind.deg;
    let dir = degToCompass(deg);

    document.getElementById("direction").textContent =
        `Wind Direction: ${dir} (${deg}Â°)`;

    // Rotate arrow based on wind direction
    document.getElementById("arrow").style.transform = `rotate(${deg}deg)`;

    document.getElementById("humidity").textContent = `Humidity: ${data.main.humidity}%`;
    document.getElementById("condition").textContent = `Condition: ${data.weather[0].description}`;

    document.getElementById("icon").src =
        `http://openweathermap.org/img/wn/${data.weather[0].icon}@4x.png`;

    updateRisk(data.wind.speed);
}

/* AUTO LOAD WEATHER */
window.onload = function() {
    navigator.geolocation.getCurrentPosition(
        pos => getWeather(pos.coords.latitude, pos.coords.longitude),
        () => console.log("GPS blocked, waiting for manual input.")
    );
};

/* Manual Entry */
function manualWeather() {
    const lat = parseFloat(document.getElementById("lat").value);
    const lon = parseFloat(document.getElementById("lon").value);
    if (!lat || !lon) { alert("Enter valid coordinates."); return; }
    getWeather(lat, lon);
}
</script>

</body>
</html>


